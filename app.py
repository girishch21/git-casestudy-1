This is the main application logic
